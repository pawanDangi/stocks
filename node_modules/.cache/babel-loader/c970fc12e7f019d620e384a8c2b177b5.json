{"ast":null,"code":"import _regeneratorRuntime from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/pdangi/intertrust/media/test-task-media/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/pdangi/intertrust/media/test-task-media/src/containers/Streams.jsx\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport StreamsHeader from '../components/streams/StreamsHeader';\nimport StreamTable from '../components/streams/StreamTable';\nimport PaperMain from '../components/PaperMain';\nimport { fetchStreams, updateStream } from '../api/streams';\nimport columns from '../columns/Streams';\nimport alert from '../utils/alert';\nimport loader from '../utils/loader';\n\nvar Streams =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Streams, _Component);\n\n  function Streams() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Streams);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Streams)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      loading: true,\n      pageSize: 50,\n      page: 0,\n      pages: 0,\n      search: '',\n      sortBy: [{\n        id: 'id',\n        desc: false\n      }],\n      streams: []\n    };\n    _this.fetchStreamsData =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var epasso, _this$state, page, pageSize, sortBy, search, sortString, res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              loader(true);\n\n              _this.setState({\n                loading: true\n              });\n\n              epasso = _this.props.cookies.epasso;\n              _this$state = _this.state, page = _this$state.page, pageSize = _this$state.pageSize, sortBy = _this$state.sortBy, search = _this$state.search;\n              sortString = sortBy[0].desc ? \"-\".concat(sortBy[0].id) : sortBy[0].id;\n              _context.next = 7;\n              return fetchStreams(epasso, page, pageSize, sortString, search);\n\n            case 7:\n              res = _context.sent;\n\n              _this.setState(_objectSpread({\n                loading: false\n              }, res), function () {\n                setInterval(function () {\n                  loader(false);\n                }, 2000);\n              });\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.onFetchData = function (state) {\n      var _this$state2 = _this.state,\n          pageSize = _this$state2.pageSize,\n          page = _this$state2.page,\n          sortBy = _this$state2.sortBy;\n\n      if (pageSize !== state.pageSize || page !== state.page || JSON.stringify(state.sorted) !== JSON.stringify(sortBy)) {\n        var size = state.pageSize < 0 ? 0 : state.pageSize;\n\n        _this.setState({\n          pageSize: size,\n          page: state.page,\n          sortBy: state.sorted\n        }, function () {\n          _this.fetchStreamsData();\n        });\n      }\n    };\n\n    _this.onSearch = function (event) {\n      var search = _this.state.search;\n      var value = event.target.value;\n\n      if (search !== value) {\n        _this.setState({\n          search: value\n        },\n        /*#__PURE__*/\n        _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2() {\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return _this.fetchStreamsData();\n\n                case 2:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        })));\n      }\n    };\n\n    _this.onStatusChange = function (stream) {\n      var epasso = _this.props.cookies.epasso;\n      var id = stream.id,\n          status = stream.status;\n      alert({\n        title: 'Confirm',\n        text: \"Do you really want to \".concat(status ? 'disable' : 'enable', \" this stream?\"),\n        handleSuccess: function () {\n          var _handleSuccess = _asyncToGenerator(\n          /*#__PURE__*/\n          _regeneratorRuntime.mark(function _callee3() {\n            return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    loader(true);\n                    _context3.next = 3;\n                    return updateStream(epasso, id, {\n                      status: !status\n                    });\n\n                  case 3:\n                    _this.fetchStreamsData();\n\n                    setInterval(function () {\n                      loader(false);\n                    }, 2000);\n\n                  case 5:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee3);\n          }));\n\n          function handleSuccess() {\n            return _handleSuccess.apply(this, arguments);\n          }\n\n          return handleSuccess;\n        }()\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Streams, [{\n    key: \"componentWillMount\",\n    value: function () {\n      var _componentWillMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.fetchStreamsData();\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function componentWillMount() {\n        return _componentWillMount.apply(this, arguments);\n      }\n\n      return componentWillMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state3 = this.state,\n          streams = _this$state3.streams,\n          loading = _this$state3.loading,\n          pages = _this$state3.pages,\n          pageSize = _this$state3.pageSize,\n          sortBy = _this$state3.sortBy;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }, React.createElement(PaperMain, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }, React.createElement(StreamsHeader, {\n        onSearch: this.onSearch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }), React.createElement(StreamTable, {\n        data: streams,\n        defaultPageSize: pageSize,\n        columns: columns(sortBy[0], this.onStatusChange),\n        pages: pages,\n        loading: loading,\n        onFetchData: this.onFetchData,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Streams;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    cookies: state.cookies\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps() {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Streams);","map":{"version":3,"sources":["/Users/pdangi/intertrust/media/test-task-media/src/containers/Streams.jsx"],"names":["React","Component","connect","StreamsHeader","StreamTable","PaperMain","fetchStreams","updateStream","columns","alert","loader","Streams","state","loading","pageSize","page","pages","search","sortBy","id","desc","streams","fetchStreamsData","setState","epasso","props","cookies","sortString","res","setInterval","onFetchData","JSON","stringify","sorted","size","onSearch","event","value","target","onStatusChange","stream","status","title","text","handleSuccess","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\n\nimport StreamsHeader from '../components/streams/StreamsHeader';\nimport StreamTable from '../components/streams/StreamTable';\nimport PaperMain from '../components/PaperMain';\nimport { fetchStreams, updateStream } from '../api/streams';\nimport columns from '../columns/Streams';\nimport alert from '../utils/alert';\nimport loader from '../utils/loader';\n\nclass Streams extends Component {\n  state = {\n    loading: true,\n    pageSize: 50,\n    page: 0,\n    pages: 0,\n    search: '',\n    sortBy: [\n      {\n        id: 'id',\n        desc: false\n      }\n    ],\n    streams: []\n  };\n\n  async componentWillMount() {\n    await this.fetchStreamsData();\n  }\n\n  fetchStreamsData = async () => {\n    loader(true);\n    this.setState({ loading: true });\n    const {\n      cookies: { epasso }\n    } = this.props;\n    const { page, pageSize, sortBy, search } = this.state;\n    const sortString = sortBy[0].desc ? `-${sortBy[0].id}` : sortBy[0].id;\n    const res = await fetchStreams(epasso, page, pageSize, sortString, search);\n    this.setState({ loading: false, ...res }, () => {\n      setInterval(() => {\n        loader(false);\n      }, 2000);\n    });\n  };\n\n  onFetchData = state => {\n    const { pageSize, page, sortBy } = this.state;\n    if (\n      pageSize !== state.pageSize ||\n      page !== state.page ||\n      JSON.stringify(state.sorted) !== JSON.stringify(sortBy)\n    ) {\n      const size = state.pageSize < 0 ? 0 : state.pageSize;\n      this.setState(\n        { pageSize: size, page: state.page, sortBy: state.sorted },\n        () => {\n          this.fetchStreamsData();\n        }\n      );\n    }\n  };\n\n  onSearch = event => {\n    const { search } = this.state;\n    const {\n      target: { value }\n    } = event;\n    if (search !== value) {\n      this.setState({ search: value }, async () => {\n        await this.fetchStreamsData();\n      });\n    }\n  };\n\n  onStatusChange = stream => {\n    const {\n      cookies: { epasso }\n    } = this.props;\n    const { id, status } = stream;\n    alert({\n      title: 'Confirm',\n      text: `Do you really want to ${\n        status ? 'disable' : 'enable'\n        } this stream?`,\n      handleSuccess: async () => {\n        loader(true);\n        await updateStream(epasso, id, { status: !status });\n        this.fetchStreamsData();\n        setInterval(() => {\n          loader(false);\n        }, 2000);\n      }\n    });\n  };\n\n  render() {\n    const { streams, loading, pages, pageSize, sortBy } = this.state;\n    return (\n      <div>\n        <PaperMain>\n          <StreamsHeader onSearch={this.onSearch} />\n          <StreamTable\n            data={streams}\n            defaultPageSize={pageSize}\n            columns={columns(sortBy[0], this.onStatusChange)}\n            pages={pages}\n            loading={loading}\n            onFetchData={this.onFetchData}\n          />\n        </PaperMain>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  cookies: state.cookies\n});\n\nconst mapDispatchToProps = () => ({});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Streams);\n"]},"metadata":{},"sourceType":"module"}